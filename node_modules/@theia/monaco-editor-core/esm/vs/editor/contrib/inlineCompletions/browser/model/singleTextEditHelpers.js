"use strict";
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
Object.defineProperty(exports, "__esModule", { value: true });
exports.singleTextRemoveCommonPrefix = singleTextRemoveCommonPrefix;
exports.singleTextEditAugments = singleTextEditAugments;
const strings_js_1 = require("../../../../../base/common/strings.js");
const range_js_1 = require("../../../../common/core/range.js");
const textLength_js_1 = require("../../../../common/core/textLength.js");
const textEdit_js_1 = require("../../../../common/core/textEdit.js");
function singleTextRemoveCommonPrefix(edit, model, validModelRange) {
    const modelRange = validModelRange ? edit.range.intersectRanges(validModelRange) : edit.range;
    if (!modelRange) {
        return edit;
    }
    const normalizedText = edit.text.replaceAll('\r\n', '\n');
    const valueToReplace = model.getValueInRange(modelRange, 1 /* EndOfLinePreference.LF */);
    const commonPrefixLen = (0, strings_js_1.commonPrefixLength)(valueToReplace, normalizedText);
    const start = textLength_js_1.TextLength.ofText(valueToReplace.substring(0, commonPrefixLen)).addToPosition(edit.range.getStartPosition());
    const text = normalizedText.substring(commonPrefixLen);
    const range = range_js_1.Range.fromPositions(start, edit.range.getEndPosition());
    return new textEdit_js_1.SingleTextEdit(range, text);
}
function singleTextEditAugments(edit, base) {
    // The augmented completion must replace the base range, but can replace even more
    return edit.text.startsWith(base.text) && rangeExtends(edit.range, base.range);
}
function rangeExtends(extendingRange, rangeToExtend) {
    return rangeToExtend.getStartPosition().equals(extendingRange.getStartPosition())
        && rangeToExtend.getEndPosition().isBeforeOrEqual(extendingRange.getEndPosition());
}
//# sourceMappingURL=singleTextEditHelpers.js.map