"use strict";
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
Object.defineProperty(exports, "__esModule", { value: true });
exports.initialize = initialize;
exports.bootstrapSimpleEditorWorker = bootstrapSimpleEditorWorker;
const simpleWorker_js_1 = require("../../../base/common/worker/simpleWorker.js");
const editorSimpleWorker_js_1 = require("./editorSimpleWorker.js");
const editorWorkerHost_js_1 = require("./editorWorkerHost.js");
let initialized = false;
function initialize(factory) {
    if (initialized) {
        return;
    }
    initialized = true;
    const simpleWorker = new simpleWorker_js_1.SimpleWorkerServer((msg) => {
        globalThis.postMessage(msg);
    }, (workerServer) => new editorSimpleWorker_js_1.EditorSimpleWorker(editorWorkerHost_js_1.EditorWorkerHost.getChannel(workerServer), null));
    globalThis.onmessage = (e) => {
        simpleWorker.onmessage(e.data);
    };
}
globalThis.onmessage = (e) => {
    // Ignore first message in this case and initialize if not yet initialized
    if (!initialized) {
        initialize(null);
    }
};
function bootstrapSimpleEditorWorker(createFn) {
    globalThis.onmessage = () => {
        initialize((ctx, createData) => {
            return createFn.call(self, ctx, createData);
        });
    };
}
//# sourceMappingURL=editorWorkerBootstrap.js.map